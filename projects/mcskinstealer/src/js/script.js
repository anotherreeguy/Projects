let currentEdition="mcpe",previousSkins=[],modalOpen=!1,makethiswebsitebetter=!1;const soundsPath="../mcskinstealer/src/sound/",sounds={click:new Audio(`${soundsPath}se_ui_common_scroll_click.wav`),hover:new Audio(`${soundsPath}se_ui_common_select_showdetail.wav`),error:new Audio(`${soundsPath}se_ui_common_select_pagemove.wav`),success:new Audio(`${soundsPath}se_ui_common_goodbtn04.wav`),completeSearchOptions:[new Audio(`${soundsPath}se_ui_common_goodbtn04.wav`),new Audio(`${soundsPath}se_ui_common_decide07.wav`)]};function toggleSound(e){makethiswebsitebetter=e,e&&document.body.addEventListener("click",(()=>{Object.values(sounds).forEach((e=>{Array.isArray(e)?e.forEach((e=>e.play().catch((()=>{})))):e.play().catch((()=>{}))}))}),{once:!0})}function playSound(e){makethiswebsitebetter&&(e.currentTime=0,e.play().catch((()=>{})))}const playSuccessSound=()=>playSound(sounds.success),playClickSound=()=>playSound(sounds.click),playHoverSound=()=>playSound(sounds.hover),playErrorSound=()=>playSound(sounds.error);function playSearchCompleteSound(){playSound(sounds.completeSearchOptions[Math.floor(Math.random()*sounds.completeSearchOptions.length)])}function updateEditionButton(){const e=document.getElementById("editionToggle");e.textContent=`Edition: ${"java"===currentEdition?"Java":"Bedrock"} Edition`,e.title=`Click to switch edition (current: ${"java"===currentEdition?"Java":"Bedrock"})`}function getAverageColor(e){const t=document.createElement("canvas"),n=t.getContext("2d");t.width=e.naturalWidth,t.height=e.naturalHeight,n.drawImage(e,0,0);const o=n.getImageData(0,0,t.width,t.height).data;let i=0,s=0,d=0,r=0;for(let e=0;e<o.length;e+=4)o[e+3]>128&&(i+=o[e],s+=o[e+1],d+=o[e+2],r++);return 0===r?{r:17,g:17,b:17}:{r:Math.floor(i/r),g:Math.floor(s/r),b:Math.floor(d/r)}}function darkenColor({r:e,g:t,b:n},o=.3){return`rgb(${Math.floor(e*o)}, ${Math.floor(t*o)}, ${Math.floor(n*o)})`}function updateFavicon(e){let t=document.querySelector("link[rel~='icon']");t||(t=document.createElement("link"),t.rel="icon",document.head.appendChild(t)),t.href=`https://mc-heads.net/avatar/${e}`}function applyBackgroundFromSkin(e){const t=new Image;t.crossOrigin="anonymous",t.src=e,t.onload=()=>{const e=getAverageColor(t);document.body.style.backgroundColor=darkenColor(e,.3)},t.onerror=()=>{document.body.style.backgroundColor="#111"}}function renderPreviousSkins(){const e=document.getElementById("previousSkins");e&&(e.innerHTML="",previousSkins.forEach(((t,n)=>{const o=document.createElement("div");o.classList.add("previous-skin-item");const i=`https://mc-heads.net/avatar/${t.textureId}/35`;o.innerHTML=`<img src="${i}" alt="Head of ${t.mcid}" class="previous-skin-img cursor-pointer" data-index="${n}" title="View ${t.username} skin preview" />`,e.appendChild(o)})),e.querySelectorAll(".previous-skin-img").forEach((e=>{e.addEventListener("click",(e=>{const t=+e.target.dataset.index;if(!previousSkins[t])return;const n=previousSkins[t],o=document.getElementById("skinPreview"),i=document.getElementById("downloadBtn");o.src=n.skinUrl,i.dataset.textureId=n.textureId,playClickSound()}))})))}async function fetchSkin(e=null){const t=document.getElementById("usernameInput"),n=document.getElementById("errorMessage"),o=document.getElementById("skinPreview"),i=document.getElementById("userDetails"),s=document.getElementById("downloadBtn"),d=document.getElementById("loadingSpinner"),r=document.getElementById("topbar"),a=document.getElementById("mainLayout"),l=document.getElementById("searchInitial"),c=e||t.value.trim();if(!c)return n.textContent="Please enter a valid username!",void playErrorSound();t.disabled=!0,s.disabled=!0,n.textContent="",d.style.display="block";try{const e=new URL(window.location);e.searchParams.set("username",c),e.searchParams.set("edition",currentEdition),window.history.replaceState({},"",e);const t=`https://server.reeguy.com///${encodeURIComponent(c)}?edition=${currentEdition}`,n=await fetch(t,{headers:{"ngrok-skip-browser-warning":"true"}});if(!n.ok)throw new Error("Network response not OK");const d=await n.json(),{texture_id:u,uuid:m,xuid:p,username:g,uid:y,description:h="No bio given.",previous_skins:v=[],isSlim:k}=d,S=m||p;if(!u||!S)throw new Error("Invalid or incomplete data received.");const E=`https://vzge.me/full/310/${u}.png?no=shadow${k?"&slim=true":""}`;updateFavicon(u),applyBackgroundFromSkin(E);const f=new Set(previousSkins.map((e=>e.textureId)));[u,...v].forEach((e=>{f.has(e)||(previousSkins.push({textureId:e,skinUrl:`https://vzge.me/full/310/${e}.png?no=shadow`,username:g,description:h,mcid:S}),f.add(e))})),previousSkins.length>20&&previousSkins.splice(0,previousSkins.length-20),renderPreviousSkins(),o.style.opacity=0,o.src=E,o.style.display="block",o.onload=()=>{o.style.transition="opacity 0.5s ease",o.style.opacity=1},i.innerHTML=`\n  <div style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif">\n    <h2 style="margin: 0 0 0.4rem; font-size: 1.8rem; font-weight: 700; color:rgb(255, 255, 255);">${g}</h2>\n    <p style="margin: 0 0 0.5rem; font-size: 1rem; line-height: 0.5; color: #ccc;">${h}</p>\n    <div style="font-size: 0.9rem">\n      <strong style="color:rgb(214, 214, 214);">${"java"===currentEdition?"UUID":"XUID"}:</strong> ${S}\n      <strong style="color:rgb(214, 214, 214);">User ID:</strong> ${y}\n    </div>\n  </div>\n`,s.style.display="inline-block",s.dataset.textureId=u,r.style.display="flex",a.style.display="flex",l.style.display="none";let w=document.querySelector("meta[name='description']");w||(w=document.createElement("meta"),w.name="description",document.head.appendChild(w)),w.content=`${g}'s profile on Minecraft Skin Finder\n${h}`,document.title=`${g} | ReeGuy's Projects`,localStorage.setItem("lastUsername",g),playSound(sounds.success),playSearchCompleteSound()}catch{n.textContent="User might not exist, or failed to load.",playErrorSound()}finally{d.style.display="none",t.disabled=!1,s.disabled=!1}}function downloadSkin(e){const t=`https://mc-heads.net/download/${e}`,n=document.createElement("a");n.href=t,n.download=`${e}.png`,document.body.appendChild(n),n.click(),document.body.removeChild(n)}function setupProfileEventListeners(){const e=document.getElementById("downloadBtn");e&&e.addEventListener("click",(()=>{playClickSound();const t=e.dataset.textureId;t&&downloadSkin(t)}))}const editionToggleBtn=document.getElementById("editionToggle");editionToggleBtn&&(editionToggleBtn.addEventListener("click",(()=>{playClickSound(),currentEdition="mcpe"===currentEdition?"java":"mcpe",updateEditionButton();const e=document.getElementById("usernameInput").value.trim();e&&fetchSkin(e)})),editionToggleBtn.addEventListener("mouseenter",(()=>playHoverSound())),editionToggleBtn.addEventListener("focus",(()=>playClickSound())),editionToggleBtn.addEventListener("keydown",(e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),editionToggleBtn.click())})));const usernameInput=document.getElementById("usernameInput");usernameInput&&(usernameInput.addEventListener("keydown",(e=>{"Enter"===e.key&&fetchSkin();const t=document.getElementById("errorMessage");t&&t.textContent&&(t.textContent="")})),usernameInput.addEventListener("focus",(()=>playClickSound())),usernameInput.addEventListener("mouseenter",(()=>playHoverSound())));const soundToggle=document.getElementById("soundToggle");soundToggle&&(soundToggle.title="Toggle sounds on/off",soundToggle.addEventListener("click",(()=>{toggleSound(!makethiswebsitebetter),playClickSound(),soundToggle.textContent=makethiswebsitebetter?"ðŸ”Š Sound ON":"ðŸ”‡ Sound OFF"})),soundToggle.addEventListener("mouseenter",(()=>playHoverSound()))),window.setupProfileEventListeners=setupProfileEventListeners,window.onload=()=>{const e=new URLSearchParams(window.location.search),t=e.get("edition"),n=e.get("username");!t||"java"!==t&&"mcpe"!==t||(currentEdition=t),updateEditionButton();const o=localStorage.getItem("lastUsername");n?(usernameInput.value=n,fetchSkin(n)):o&&(usernameInput.value=o)};
