let currentEdition="mcpe",previousSkins=[],makethiswebsitebetter=!1;const soundsPath="../mcskinstealer/src/sound/",sounds={click:new Audio(`${soundsPath}se_ui_common_scroll_click.wav`),hover:new Audio(`${soundsPath}se_ui_common_select_showdetail.wav`),error:new Audio(`${soundsPath}se_ui_common_select_pagemove.wav`),success:new Audio(`${soundsPath}se_ui_common_goodbtn04.wav`),completeSearchOptions:[new Audio(`${soundsPath}se_ui_common_goodbtn04.wav`),new Audio(`${soundsPath}se_ui_common_decide07.wav`)]};function toggleSound(e){makethiswebsitebetter=e,e&&document.body.addEventListener("click",(()=>{Object.values(sounds).forEach((e=>Array.isArray(e)?e.forEach((e=>e.play().catch((()=>{})))):e.play().catch((()=>{}))))}),{once:!0})}const snd=e=>{if(!makethiswebsitebetter)return;let t;switch(e){case"success":t=sounds.success;break;case"click":t=sounds.click;break;case"hover":t=sounds.hover;break;case"error":t=sounds.error;break;case"searchComplete":t=sounds.completeSearchOptions[Math.floor(Math.random()*sounds.completeSearchOptions.length)];break;default:return}t.currentTime=0,t.play().catch((()=>{}))},sndSuccess=()=>snd("success"),sndClick=()=>snd("click"),sndHover=()=>snd("hover"),sndError=()=>snd("error"),sndSearchComplete=()=>snd("searchComplete"),avgDark=(e,t=.3)=>{const n=document.createElement("canvas"),o=n.getContext("2d");n.width=e.naturalWidth,n.height=e.naturalHeight,o.drawImage(e,0,0);const s=o.getImageData(0,0,n.width,n.height).data;let r=0,i=0,d=0,a=0;for(let e=0;e<s.length;e+=4)s[e+3]>128&&(r+=s[e],i+=s[e+1],d+=s[e+2],a++);const c=0===a?{r:17,g:17,b:17}:{r:Math.floor(r/a),g:Math.floor(i/a),b:Math.floor(d/a)};return{avg:c,dark:`rgb(${Math.floor(c.r*t)}, ${Math.floor(c.g*t)}, ${Math.floor(c.b*t)})`}},setFavBg=(e,t)=>{let n=document.querySelector("link[rel~='icon']");n||(n=document.createElement("link"),n.rel="icon",document.head.appendChild(n)),n.href=`https://mc-heads.net/avatar/${e}`;const o=new Image;o.crossOrigin="anonymous",o.src=t,o.onload=()=>{document.body.style.backgroundColor=avgDark(o).dark},o.onerror=()=>{document.body.style.backgroundColor="#111"}},updateEditionButton=()=>{const e=document.getElementById("editionToggle");if(e){const t="java"===currentEdition;e.textContent=`Edition: ${t?"Java":"Bedrock"} Edition`,e.title=`Click to switch edition (current: ${t?"Java":"Bedrock"})`}},renderPreviousSkins=()=>{const e=document.getElementById("previousSkins");e&&(e.innerHTML="",previousSkins.forEach(((t,n)=>{const o=document.createElement("div");o.classList.add("previous-skin-item"),o.innerHTML=`<img src="https://mc-heads.net/avatar/${t.textureId}/32" alt="Head of ${t.mcid}" class="previous-skin-img cursor-pointer" data-index="${n}" title="View ${t.username} skin preview" />`,e.appendChild(o)})),e.querySelectorAll(".previous-skin-img").forEach((e=>{e.addEventListener("click",(e=>{const t=+e.target.dataset.index;if(!previousSkins[t])return;const n=previousSkins[t],o=document.getElementById("skinPreview"),s=document.getElementById("downloadBtn");o.src=n.skinUrl;let r="";if(n.skinUrl){const e=n.skinUrl.match(/\/([^\/\?]+)\.png/);e&&e[1]&&(r=e[1])}!r&&n.textureId&&(r=n.textureId),s.dataset.textureId=r,s.setAttribute("data-texture-id",r),sndClick()}))})))};async function Ak1(e,t){if(!e)return null;try{const n=`https://server.reeguy.com/${encodeURIComponent(e)}?edition=${t}`,o=await fetch(n);if(!o.ok)return null;const s=await o.json();return s&&s.texture_id?s.texture_id:null}catch{return null}}async function fetchSkin(e=null){const t=document.getElementById("usernameInput"),n=document.getElementById("errorMessage"),o=document.getElementById("skinPreview"),s=document.getElementById("userDetails"),r=document.getElementById("downloadBtn"),i=document.getElementById("loadingSpinner"),d=document.getElementById("topbar"),a=document.getElementById("mainLayout"),c=document.getElementById("searchInitial"),l=e||t.value.trim();if(!l)return n.textContent="Either the username is incorrect or you haven't joined a server with the plugin 'Geyser' in it!",void sndError();t.disabled=r.disabled=!0,n.textContent="",i.style.display="block";try{const e=await Ak1(l,currentEdition);if(!e)throw new Error("Could not fetch texture ID.");const t=new URL(window.location);t.searchParams.set("username",l),t.searchParams.set("edition",currentEdition),window.history.replaceState({},"",t);const n=`https://server.reeguy.com/${encodeURIComponent(l)}?edition=${currentEdition}`,i=await fetch(n);if(!i.ok)throw new Error("Network response not OK");const u=await i.json(),{uuid:m,xuid:h,username:g,uid:p,description:v="No bio given.",previous_skins:y=[],isSlim:k}=u,w=m||h;if(!e||!w)throw new Error("Invalid or incomplete data received.");g&&"envixitybo2"===g.toLowerCase()&&new Audio("src/sound/creditstonintendo.mp3").play().catch((()=>{})),g&&"technoblade"===g.toLowerCase()&&new Audio("src/sound/techno.mp3").play().catch((()=>{}));const E=`https://vzge.me/full/340/${e}.png?no=shadow${k?"&slim=true":""}`;setFavBg(e,E);const f=new Set(previousSkins.map((e=>e.textureId)));[e,...y].forEach((e=>{f.has(e)||(previousSkins.push({textureId:e,skinUrl:`https://vzge.me/full/340/${e}.png?no=shadow${k?"&slim=true":""}`,username:g,description:v,mcid:w}),f.add(e))})),previousSkins.length>20&&previousSkins.splice(0,previousSkins.length-20),renderPreviousSkins(),o.style.opacity=0,o.src=E,o.style.display="block",o.onload=()=>{o.style.transition="opacity 0.5s ease",o.style.opacity=1},s.innerHTML=`<div>\n    <h2 style="margin: 0 0 0.4rem; font-size: 1.8rem; font-weight: 700; color:rgb(255, 255, 255);">${g}</h2>\n    <p style="margin: 0 0 0.5rem; font-size: 1rem; line-height: 0.5; color: #ccc;">${v}</p>\n    <div style="font-size: 0.9rem">\n    <strong style="color:rgb(214, 214, 214);">${"java"===currentEdition?"UUID":"XUID"}:</strong> ${w}    <strong style="color:rgb(214, 214, 214);">User ID:</strong> ${p}\n    </div>\n    </div>`,r.style.display="inline-block",r.dataset.textureId=e||"",r.setAttribute("data-texture-id",e||""),d.style.display=a.style.display="flex",c.style.display="none";let I=document.querySelector("meta[name='description']");I||(I=document.createElement("meta"),I.name="description",document.head.appendChild(I)),I.content=`${g}'s profile on Minecraft Skin Finder\n${v}`,document.title=`${g} | ReeGuy's Projects`,localStorage.setItem("lastUsername",g),snd("success"),snd("searchComplete")}catch{n.textContent="User might not exist, or failed to load.",sndError()}finally{i.style.display="none",t.disabled=r.disabled=!1}}async function downloadSkin(e){const t=document.getElementById("usernameInput"),n=t?.value.trim();let o=e;if(n){const e=await Ak1(n,currentEdition);e&&(o=e)}if(!o)return alert("Could not determine the correct texture ID for download."),void sndError();window.location.href=`https://mc-heads.net/download   /${o}`}const setupProfileEventListeners=()=>{document.getElementById("downloadBtn")?.addEventListener("click",(()=>{sndClick();const e=document.getElementById("downloadBtn").dataset.textureId;e&&downloadSkin(e)}))},editionToggleBtn=document.getElementById("editionToggle");editionToggleBtn&&(["mouseenter","focus"].forEach((e=>editionToggleBtn.addEventListener(e,"focus"===e?sndClick:sndHover))),editionToggleBtn.addEventListener("click",(()=>{sndClick(),currentEdition="mcpe"===currentEdition?"java":"mcpe",updateEditionButton();const e=document.getElementById("usernameInput").value.trim();e&&fetchSkin(e)})),editionToggleBtn.addEventListener("keydown",(e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),editionToggleBtn.click())})));const usernameInput=document.getElementById("usernameInput");usernameInput&&(usernameInput.addEventListener("keydown",(e=>{"Enter"===e.key&&fetchSkin();const t=document.getElementById("errorMessage");t?.textContent&&(t.textContent="")})),["focus","mouseenter"].forEach((e=>usernameInput.addEventListener(e,"focus"===e?sndClick:sndHover)))),window.setupProfileEventListeners=setupProfileEventListeners,window.onload=()=>{const e=new URLSearchParams(window.location.search),t=e.get("edition"),n=e.get("username");!t||"java"!==t&&"mcpe"!==t||(currentEdition=t),updateEditionButton();const o=localStorage.getItem("lastUsername");n?(usernameInput.value=n,fetchSkin(n)):o&&(usernameInput.value=o)};