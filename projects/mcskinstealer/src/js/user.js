let currentEdition="mcpe",previousSkins=[],makethiswebsitebetter=!1;const soundsPath="../mcskinstealer/src/sound/",sounds={click:new Audio(`${soundsPath}se_ui_common_scroll_click.wav`),hover:new Audio(`${soundsPath}se_ui_common_select_showdetail.wav`),error:new Audio(`${soundsPath}se_ui_common_select_pagemove.wav`),success:new Audio(`${soundsPath}se_ui_common_goodbtn04.wav`)};function playSound(e){makethiswebsitebetter&&(e.currentTime=0,e.play().catch((()=>{})))}const playSuccessSound=()=>playSound(sounds.success),playClickSound=()=>playSound(sounds.click),playHoverSound=()=>playSound(sounds.hover),playErrorSound=()=>playSound(sounds.error);function getAverageColor(e){const n=document.createElement("canvas"),t=n.getContext("2d");n.width=e.naturalWidth,n.height=e.naturalHeight,t.drawImage(e,0,0);const o=t.getImageData(0,0,n.width,n.height).data;let r=0,s=0,i=0,d=0;for(let e=0;e<o.length;e+=4)o[e+3]>128&&(r+=o[e],s+=o[e+1],i+=o[e+2],d++);return 0===d?{r:17,g:17,b:17}:{r:Math.floor(r/d),g:Math.floor(s/d),b:Math.floor(i/d)}}function darkenColor({r:e,g:n,b:t},o=.3){return`rgb(${Math.floor(e*o)}, ${Math.floor(n*o)}, ${Math.floor(t*o)})`}function updateFavicon(e){let n=document.querySelector("link[rel~='icon']");n||(n=document.createElement("link"),n.rel="icon",document.head.appendChild(n)),n.href=`https://mc-heads.net/avatar/${e}`}function applyBackgroundFromSkin(e){const n=new Image;n.crossOrigin="anonymous",n.src=e,n.onload=()=>{const e=getAverageColor(n);document.body.style.backgroundColor=darkenColor(e,.3)},n.onerror=()=>{document.body.style.backgroundColor="#111"}}function renderPreviousSkins(){const e=document.getElementById("previousSkins");e&&(e.innerHTML="",previousSkins.forEach(((n,t)=>{const o=document.createElement("div");o.classList.add("previous-skin-item");const r=`https://mc-heads.net/avatar/${n.textureId}/35`;o.innerHTML=`<img src="${r}" alt="Head of ${n.mcid}" class="previous-skin-img cursor-pointer" data-index="${t}" title="View ${n.username} skin preview" />`,e.appendChild(o)})),e.querySelectorAll(".previous-skin-img").forEach((e=>{e.addEventListener("click",(e=>{const n=+e.target.dataset.index;if(!previousSkins[n])return;const t=previousSkins[n],o=document.getElementById("skinPreview"),r=document.getElementById("downloadBtn");o.src=t.skinUrl,r.dataset.textureId=t.textureId,playClickSound()}))})))}async function fetchAndRenderUser(){const e=new URLSearchParams(window.location.search),n=e.get("username"),t=e.get("edition");if(!t||"java"!==t&&"mcpe"!==t||(currentEdition=t),!n)return;const o=document.getElementById("skinPreview"),r=document.getElementById("userDetails"),s=document.getElementById("downloadBtn"),i=document.getElementById("loadingSpinner");i.style.display="block";try{const e=`https://tolerant-destined-mosquito.ngrok-free.app///${encodeURIComponent(n)}?edition=${currentEdition}`,t=await fetch(e,{headers:{"ngrok-skip-browser-warning":"true"}});if(!t.ok)throw new Error("Network response not OK");const i=await t.json(),{texture_id:d,uuid:a,xuid:c,username:l,uid:u,description:m="No bio given.",previous_skins:p=[],isSlim:h}=i,g=a||c;if(!d||!g)throw new Error("Invalid or incomplete data received.");const y=`https://vzge.me/full/310/${d}.png?no=shadow${h?"&slim=true":""}`;updateFavicon(d),applyBackgroundFromSkin(y);const k=new Set(previousSkins.map((e=>e.textureId)));[d,...p].forEach((e=>{k.has(e)||(previousSkins.push({textureId:e,skinUrl:`https://vzge.me/full/310/${e}.png?no=shadow`,username:l,description:m,mcid:g}),k.add(e))})),previousSkins.length>20&&previousSkins.splice(0,previousSkins.length-20),renderPreviousSkins(),o.style.opacity=0,o.src=y,o.style.display="block",o.onload=()=>{o.style.transition="opacity 0.5s ease",o.style.opacity=1},r.innerHTML=`\n      <div style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif">\n        <h2 style="margin: 0 0 0.4rem; font-size: 1.8rem; font-weight: 700; color:rgb(255, 255, 255);">${l}</h2>\n        <p style="margin: 0 0 0.5rem; font-size: 1rem; line-height: 0.5; color: #ccc;">${m}</p>\n        <div style="font-size: 0.9rem">\n          <strong style="color:rgb(214, 214, 214);">${"java"===currentEdition?"UUID":"XUID"}:</strong> ${g}\n          <strong style="color:rgb(214, 214, 214);">User ID:</strong> ${u}\n        </div>\n      </div>\n    `,s.style.display="inline-block",s.dataset.textureId=d;let v=document.querySelector("meta[name='description']");v||(v=document.createElement("meta"),v.name="description",document.head.appendChild(v)),v.content=`${l}'s User on Minecraft Skin Finder\n${m}`,document.title=`${l} | ReeGuy's Projects`,playSound(sounds.success),playSearchCompleteSound()}catch{r.textContent="User might not exist, or failed to load.",playSound(sounds.error)}finally{i.style.display="none"}}function downloadSkin(e){const n=`https://mc-heads.net/download/${e}`,t=document.createElement("a");t.href=n,t.download=`${e}.png`,document.body.appendChild(t),t.click(),document.body.removeChild(t)}document.getElementById("downloadBtn").addEventListener("click",(()=>{playClickSound();const e=document.getElementById("downloadBtn").dataset.textureId;e&&downloadSkin(e)})),window.onload=fetchAndRenderUser;